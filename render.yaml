# Render manifest for easy deployment (fill <your-repo> and branch if needed)
# See: https://render.com/docs/render-yaml
services:
  - type: web
    name: gemini-backend
    env: docker
    repo: https://github.com/SushreeSudiptaJena/Github-Clone.git
    branch: main
    dockerfilePath: backend/Dockerfile
    plan: free
    autoDeploy: true
    envVars:
      - key: DATABASE_URL
        sync: true
      - key: SECRET_KEY
        sync: true
      - key: APP_ENV
        value: production
      - key: OPENAI_API_KEY
        sync: true
      - key: FRONTEND_URL
        sync: true

  - type: web
    name: gemini-frontend
    env: static
    repo: https://github.com/SushreeSudiptaJena/Github-Clone.git
    branch: main
    root: frontend
    buildCommand: npm ci && npm run build
    staticPublishPath: dist
    plan: free
    autoDeploy: true
    envVars:
      - key: VITE_API_URL
        sync: true

databases:
  - name: gemini-db
    plan: starter
    disk: 1

jobs:
  - type: job
    name: run-migrations
    env: docker
    repo: https://github.com/SushreeSudiptaJena/Github-Clone.git
    branch: main
    dockerfilePath: backend/Dockerfile
    plan: free
    command: alembic upgrade head
    maxAttempts: 1

# Notes:
# - Replace <YOUR_GITHUB_REPO_URL> with your repository URL (e.g., https://github.com/your-org/gemini-clone)
# - Render will create a managed Postgres and provide DATABASE_URL; use the Render dashboard to set or sync env vars as needed.
# - The `run-migrations` job can be executed manually from the Render dashboard after the DB is provisioned, or triggered from a deploy hook or GitHub action.
